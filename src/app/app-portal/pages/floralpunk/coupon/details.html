<div class="page-wrapper d-flex flex-column pt-4 w-100">
  <div class="container-xl">
    <div class="page-header d-print-none">
      <div class="row align-items-center">
        <div class="col">
          <div class="page-pretitle">Creating</div>
          <h3 class="page-title">New Coupon</h3>
        </div>
      </div>
    </div>
  </div>
  <div class="page-body d-flex flex-row-reverse">
    <aside class="bd-sidebar sub-sidebar">
      <nav class="bd-links p-3" aria-label="Sub-section navigation">
        <div class="card">
          <actions
            preview-url="viewmodel.fullPath"
            back-url="'/portal/floralpunk/coupon/list'"
          >
          </actions>
        </div>
      </nav>
    </aside>

    <!-- ----------------------------------------------------------- -->

    <div class="content-body py-3 pe-3">
      <!-- Main content -->
      <div class="card">
        <div class="card-body">
          <section class="" ng-init="getSingle()">
            <form
              ng-if="viewmodel"
              ng-class="{'submitted': submitted}"
              ng-submit="save()"
            >
              <div class="mb-3">
                <label class="form-label">Title</label>
                <input
                  type="text"
                  required
                  class="form-control form-control-lg"
                  ng-model="viewmodel.title"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Code</label>
                <qr-code model="viewmodel.code"></qr-code>
              </div>
              <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea
                  type="text"
                  class="form-control"
                  ng-model="viewmodel.description"
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Edm Template (Filename)</label>
                <input
                  type="text"
                  required
                  class="form-control form-control-lg"
                  ng-model="viewmodel.edmTemplate"
                />
              </div>
              <div class="mb-3">
                <div class="row" ng-if="viewmodel.id">
                  <a
                    href="/portal/floralpunk/coupon-rule/create?couponId={{viewmodel.id}}"
                    class="btn btn-link"
                  >
                    Create
                  </a>
                  <table
                    class="table table-sm table-hover mb-0"
                    cellspacing="0"
                  >
                    <thead class="thead-light">
                      <tr>
                        <th scope="col" class="col">Tier</th>
                        <th scope="col" class="col">Start At</th>
                        <th scope="col" class="col">End At</th>
                        <th scope="col" class="col"></th>
                      </tr>
                    </thead>

                    <tbody class="sortable">
                      <tr
                        ng-repeat="item in viewmodel.rules track by $index"
                        class="sortable-item"
                        sort-model="floralpunk/coupon"
                        sort-model-id="{{item.id}}"
                      >
                        <td>
                          <span ng-bind="item.tier"></span>
                        </td>
                        <td>
                          <span ng-bind="item.startAt | utcToLocal"></span>
                        </td>
                        <td>
                          <span ng-bind="item.endAt | utcToLocal"></span>
                        </td>
                        <td>
                          <div
                            class="btn-group btn-group-sm btn-group-sm float-end"
                            role="group"
                            aria-label="Actions"
                          >
                            <a
                              href="#"
                              ng-click="removeRule(item.id);"
                              class="btn btn-link text-danger"
                            >
                              <span class="fas fa-trash-alt"></span>
                            </a>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Image</label>
                <media-file-upload
                  header="'Media Upload'"
                  type="'Medias'"
                  folder="'Medias'"
                  auto="'true'"
                  src-url="viewmodel.image"
                  src="viewmodel.image"
                >
                </media-file-upload>
              </div>
            </form>
          </section>
        </div>
      </div>
      <!-- /.content -->
    </div>
  </div>
</div>
